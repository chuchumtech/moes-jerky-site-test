<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Moe's Jerky Admin</title>
  <style>
    body { margin: 0; font-family: sans-serif; }
    #login { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
    .code-box { width: 40px; height: 50px; font-size: 24px; text-align: center; margin: 0 5px; }
    #login-error { color: red; margin-top: 10px; }
    #admin { display: none; height: 100vh; }
    .sidebar { position: fixed; top: 0; left: 0; width: 200px; height: 100%; background: #333; color: white; padding: 1rem; box-sizing: border-box; transition: width 0.3s; overflow: hidden; }
    .sidebar.collapsed { width: 50px; }
    .sidebar .toggle-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; margin-bottom: 1rem; }
    .sidebar .tab-btn { display: block; width: 100%; background: none; border: none; color: white; text-align: left; padding: 10px; cursor: pointer; box-sizing: border-box; }
    .sidebar .tab-btn.active { background: #8b0000; }
    .content { margin-left: 200px; padding: 2rem; box-sizing: border-box; height: 100vh; overflow-y: auto; transition: margin-left 0.3s; }
    .sidebar.collapsed + .content { margin-left: 50px; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    input[type="text"], input[type="number"], select { padding: 6px; width: 100%; box-sizing: border-box; }
    .add-btn, .save-btn, .export-btn { margin-top: 1rem; padding: 8px 12px; background: #8b0000; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="login">
    <h2>Enter Admin Code</h2>
    <div style="display:flex;">
      <input maxlength="1" class="code-box" />
      <input maxlength="1" class="code-box" />
      <input maxlength="1" class="code-box" />
      <input maxlength="1" class="code-box" />
      <input maxlength="1" class="code-box" />
      <input maxlength="1" class="code-box" />
    </div>
    <div id="login-error"></div>
  </div>

  <!-- Admin Interface -->
  <div id="admin">
    <div class="sidebar" id="sidebar">
      <button class="toggle-btn" onclick="toggleSidebar()">â˜°</button>
      <div id="loggedInUser" style="margin-bottom:1rem;"></div>
      <button class="tab-btn" data-tab="orders" onclick="switchTab('orders')">Orders</button>
      <button class="tab-btn" data-tab="products" onclick="switchTab('products')">Products</button>
      <button class="tab-btn" data-tab="users" onclick="switchTab('users')">Users</button>
      <button class="tab-btn" data-tab="analytics" onclick="switchTab('analytics')">Analytics</button>
    </div>
    <div class="content">
      <div id="ordersTab" class="tab-content">
        <h2>Orders Management</h2>
        <input id="orderSearch" placeholder="Search orders by name/email/phone" oninput="renderOrders()" />
        <button class="export-btn" onclick="exportOrders()">Export CSV</button>
        <table id="ordersTable"><tr><th>Customer</th><th>Items</th><th>Total</th><th>Status</th><th>Actions</th></tr></table>
      </div>
      <div id="productsTab" class="tab-content">
        <h2>Product Management</h2>
        <table id="productsTable"><tr><th>Name</th><th>Price</th><th>Actions</th></tr></table>
        <button class="add-btn" onclick="addProduct()">+ Add New Item</button>
        <button class="save-btn" onclick="saveProducts()">Save Changes</button>
      </div>
      <div id="usersTab" class="tab-content">
        <h2>User Management</h2>
        <table id="usersTable"><tr><th>Name</th><th>Code</th><th>Actions</th></tr></table>
        <input id="newUserName" placeholder="Name" style="margin-top:10px;" />
        <input id="newUserCode" placeholder="6-digit Code" style="margin-top:10px;" />
        <button class="add-btn" onclick="addUser()">Add User</button>
        <button class="save-btn" onclick="saveUsers()">Save All Users</button>
      </div>
      <div id="analyticsTab" class="tab-content">
        <h2>Analytics Dashboard</h2>
        <div id="stats">
          <p>Total Sales: <span id="totalSales">$0.00</span></p>
          <p>Number of Orders: <span id="orderCount">0</span></p>
          <p>Avg Order Value: <span id="avgOrder">$0.00</span></p>
        </div>
        <h3>Top Products</h3>
        <ul id="topProducts"></ul>
        <h3>Customer Spending</h3>
        <ul id="customerStats"></ul>
      </div>
    </div>
  </div>

  <script>
    let users=[], items=[], orders=[], currentUser=null;
    window.onload = function() {
      const boxes = document.querySelectorAll('.code-box');
      boxes[0].focus();
      boxes.forEach((b,i) => {
        b.addEventListener('input', () => {
          if (b.value && i < boxes.length-1) boxes[i+1].focus();
          if (Array.from(boxes).every(x=>x.value)) checkCode();
        });
        b.addEventListener('keydown', e => {
          if (e.key==='Backspace' && !b.value && i>0) boxes[i-1].focus();
        });
      });
    };
    async function checkCode(){
      const code = Array.from(document.querySelectorAll('.code-box')).map(x=>x.value).join('');
      if (code==='258022') { currentUser={name:'Super Admin'}; showAdmin(); return; }
      const res=await fetch('https://moes-jerky-backend3.onrender.com/users'); users=await res.json();
      const u=users.find(x=>x.code===code);
      if (u) { currentUser=u; showAdmin(); } else { document.getElementById('login-error').innerText='Invalid code'; }
    }
    function showAdmin(){
      document.getElementById('login').style.display='none';
      document.getElementById('admin').style.display='flex';
      document.getElementById('loggedInUser').innerText=`Logged in as: ${currentUser.name}`;
      switchTab('orders');
    }
    function toggleSidebar(){
      document.getElementById('sidebar').classList.toggle('collapsed');
    }
    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
      document.getElementById(tab+'Tab').classList.add('active');
      document.querySelectorAll('.sidebar .tab-btn').forEach(b=>b.classList.remove('active'));
      document.querySelector(`.sidebar .tab-btn[data-tab="${tab}"]`).classList.add('active');
      if (tab==='orders') renderOrders();
      if (tab==='products') renderProducts();
      if (tab==='users') renderUsers();
      if (tab==='analytics') renderAnalytics();
    }
    async function renderOrders(){
      const res=await fetch('https://moes-jerky-backend3.onrender.com/orders'); orders=await res.json();
      const table=document.getElementById('ordersTable'); const s=document.getElementById('orderSearch').value.toLowerCase();
      table.innerHTML='<tr><th>Customer</th><th>Items</th><th>Total</th><th>Status</th><th>Actions</th></tr>';
      orders.filter(o=>{const c=o.customer; return c.name.toLowerCase().
